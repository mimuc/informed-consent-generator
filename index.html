<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="author" content="Valentin Schwind">
    <meta name="author" content="Florian Heller">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

    <!-- Include Handlebars  -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="templates/template_en.precompiled.js"></script>

    <link rel="stylesheet" href="css/style.css" />
    <meta property="og:site_name" content="Informed Consent Generator"> 
    <title>Informed Consent Generator</title>   
    <link rel="shortcut icon" href="favicon.png" type="image/png">
</head>
 <body class="transparent">
    
    <div id="mainFrame" class="vertical-center">
        <a id="downloadAnchorElem" style="display:none"></a>
        <div id="demographicsPage" class="whiteBox container rounded">
            <form id="demographicsForm" class="form-horizontal" action="javascript:generate(this);">
                <div id="input">
                    <div class="">
                        <div class="col mt-4 mb-2 ">
                            <a id="hostUrl" href=""><span id="fhlogo">
                                <svg id="fhlogo_text" viewBox="0 0 112.02 601.71" xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path d="m61.22,0c-9.46,0-6.17,14.09-13.14,14.09-2.59,0-4.89-1.79-4.89-6.32,0-2.37.51-4.38,1.39-6.46l-2.15-.44c-.91,1.93-1.46,4.34-1.46,7.01,0,5.88,3.14,8.51,7.27,8.51,9.02,0,5.8-14.06,13.14-14.06,3.54,0,5.66,2.23,5.66,6.57,0,2.88-.73,5.22-2.12,7.34l2.26.44c1.28-2.08,2.12-4.64,2.12-7.78,0-5.84-3.07-8.91-8.07-8.91m5.3,35.48h-11.06v-12.01h-2.04v12.01h-9.75v-13.87l-2.27.11v16.14h27.38v-16.79l-2.26-.11v14.53h0Zm-24.24,7.63c-.69,1.42-1.31,4.09-1.31,6.39,0,7.96,4.23,11.54,13.84,11.54,10.08,0,14.49-3.51,14.49-11.46,0-2.45-.77-4.96-1.64-6.61l-2.08.4c.88,1.64,1.42,3.61,1.42,5.91,0,6.32-2.92,9.27-12.19,9.27-8.69,0-11.54-2.92-11.54-9.16,0-2.26.55-4.45,1.24-5.95l-2.23-.33Zm26.51,23.71h-27.38v2.15l20.19-.04,2.92-.07.03.07-2.48,1.61-20.66,13.69v2.37h27.38v-2.19h-20.66l-2.96.04-.04-.07,2.48-1.61,21.17-14.16v-1.79h0Zm-2.26,39.53h-11.06v-12.01h-2.04v12.01h-9.75v-13.87l-2.27.11v16.14h27.38v-16.79l-2.26-.11v14.53h0Zm2.26,9.5h-27.38v2.41h27.38v-2.41Zm-26.51,7.91c-.69,1.42-1.31,4.09-1.31,6.39,0,7.96,4.23,11.54,13.84,11.54,10.08,0,14.49-3.51,14.49-11.46,0-2.45-.77-4.96-1.64-6.61l-2.08.4c.88,1.64,1.42,3.61,1.42,5.92,0,6.32-2.92,9.27-12.19,9.27-8.69,0-11.54-2.92-11.54-9.16,0-2.26.55-4.45,1.24-5.95l-2.23-.33Zm18.95,22.14c-9.46,0-6.17,14.09-13.14,14.09-2.59,0-4.89-1.79-4.89-6.32,0-2.37.51-4.38,1.39-6.46l-2.15-.44c-.91,1.93-1.46,4.34-1.46,7.01,0,5.88,3.14,8.51,7.27,8.51,9.02,0,5.8-14.06,13.14-14.06,3.54,0,5.66,2.23,5.66,6.57,0,2.88-.73,5.22-2.12,7.34l2.26.44c1.28-2.08,2.12-4.64,2.12-7.78,0-5.84-3.07-8.91-8.07-8.91m-6.24,34.79c9.05,0,11.5,2.99,11.5,9.02v6.5h-22.74v-6.46c0-6.35,2.59-9.05,11.24-9.05m0-2.52c-9.71,0-13.58,3.43-13.58,11.5v8.94h27.38v-8.98c0-7.78-3.8-11.46-13.8-11.46m11.54,40.19h-11.06v-12.01h-2.04v12.01h-9.75v-13.87l-2.27.11v16.14h27.38v-16.79l-2.26-.11v14.53h0Zm2.26,9.5h-27.38v2.41h27.38v-2.41Zm-2.34,20.99h-25.04v2.41h27.38v-15.88l-2.34-.11v13.58Zm-16.9,10.07c4.64,0,6.1,2.19,6.1,6.46v6.32h-12.08v-6.32c0-4.38,1.61-6.46,5.99-6.46m0-2.45c-5.73,0-8.14,2.7-8.14,8.91v8.73h27.38v-2.41h-11.06v-6.32c0-6.28-2.66-8.91-8.18-8.91m0,25.29c4.64,0,6.1,2.19,6.1,6.46v6.32h-12.08v-6.32c0-4.38,1.61-6.46,5.99-6.46m0-2.45c-5.73,0-8.14,2.7-8.14,8.91v8.73h27.38v-2.41h-11.06v-6.32c0-6.28-2.66-8.91-8.18-8.91m-6.35,34.24v-.11l2.81-.91,13.4-4.78v11.61l-13.4-4.86-2.81-.95Zm25.59-9.16v-2.7l-27.38,10.4v2.85l27.38,10.4v-2.59l-7.23-2.59v-13.18l7.23-2.59Zm-25.04,34.28l-2.34.07v16.14h27.38v-2.41h-12.96v-11.61h-2.19v11.61h-9.89v-13.8Zm11.35,24.57c9.2,0,11.86,2.37,11.86,8.4s-2.66,8.47-11.86,8.47-11.83-2.41-11.83-8.43,2.59-8.43,11.83-8.43m0-2.48c-10.15,0-14.13,2.96-14.13,10.92s3.98,10.92,14.13,10.92,14.2-3.03,14.2-10.92-4.02-10.92-14.2-10.92m-13.69,58.19l17.78-9.71h9.6v-2.45h-9.6l-17.78-9.6v2.7l12.82,6.75,2.63,1.28v.11l-2.63,1.31-12.82,6.79v2.81Zm2.34,2.82l-2.34.04v19.5l2.34.07v-8.58h25.04v-2.41h-25.04v-8.62Zm25.04,24.06h-27.38v2.41h27.38v-2.41Zm-7.56,7.41c-9.46,0-6.17,14.09-13.14,14.09-2.59,0-4.89-1.79-4.89-6.32,0-2.37.51-4.38,1.39-6.46l-2.15-.44c-.91,1.93-1.46,4.34-1.46,7.01,0,5.88,3.14,8.51,7.27,8.51,9.02,0,5.8-14.05,13.14-14.05,3.54,0,5.66,2.23,5.66,6.57,0,2.89-.73,5.22-2.12,7.34l2.26.44c1.28-2.08,2.12-4.64,2.12-7.78,0-5.84-3.07-8.91-8.07-8.91m-12.3,24.12c3.98,0,5.59,1.79,5.59,5.77v6.24h-10.95v-6.46c0-3.83,1.53-5.55,5.37-5.55m-.11-2.48c-5,0-7.41,2.52-7.41,8.03v8.87h27.38v-2.41h-12.3v-6.35l12.3-7.01v-2.92l-12.74,7.63c-.44-3.8-2.78-5.84-7.23-5.84m17.71,36.28h-11.06v-12.01h-2.04v12.01h-9.75v-13.87l-2.27.11v16.14h27.38v-16.79l-2.26-.11v14.53h0Zm-25.12,9.35l22.31,7.81,2.77.91v.11l-2.81.91-22.27,7.81v2.67l27.38-9.97v-2.81l-27.38-9.97v2.52h0Zm27.38,24.88h-27.38v2.41h27.38v-2.41Zm0,9.23h-27.38v2.15l20.19-.04,2.92-.07.03.07-2.48,1.61-20.66,13.69v2.37h27.38v-2.19h-20.66l-2.96.04-.04-.07,2.48-1.61,21.17-14.16v-1.79h0Zm-27.38,25.99v2.41h17.49c5.55,0,8.07,2.56,8.07,7.67s-2.45,7.7-8.07,7.7h-17.49v2.41h17.49c7.34,0,10.41-3.72,10.41-10.11s-3.07-10.08-10.41-10.08h-17.49Z"></path>
                                        <path d="m27.86,400.43H.48v4.45h15.48l2.92-.07.04.07-2.45,1.64-15.99,10.92v4.38h27.38v-4.49H11.68l-2.96.04-.04-.07,2.48-1.64,16.68-11.68v-3.54Zm-4.49,38.04h-7.59v-10.66h-4.12v10.66h-6.61v-12.56l-4.56.07v17.53h27.38v-18.07l-4.49-.11v13.14h0Zm4.49,10.06H.48v5.04h10.99v11.14H.48v5.04h27.38v-5.04h-11.76v-11.14h11.76v-5.04Zm-26.65,24.72c-.66,1.53-1.21,4.13-1.21,6.35,0,8.54,4.67,12.38,13.95,12.38,9.86,0,14.42-3.87,14.42-12.08,0-2.37-.66-4.97-1.53-6.75l-4.2.58c.69,1.57,1.17,3.4,1.17,5.51,0,5.37-2.3,7.45-9.82,7.45-7.08,0-9.35-2.01-9.35-7.34,0-2.12.44-4.12.99-5.55l-4.42-.55Zm2.96,32.48v-.11l2.85-.77,10.7-3.29v8.32l-10.7-3.32-2.85-.84Zm23.69-7.27v-5.66L.48,502.62v6.02l27.38,9.75v-5.37l-5.88-1.83v-10.95l5.88-1.79Zm-23.69,34.6v-.11l2.85-.77,10.7-3.28v8.32l-10.7-3.32-2.85-.84Zm23.69-7.27v-5.66l-27.38,9.82v6.02l27.38,9.75v-5.37l-5.88-1.83v-10.95l5.88-1.79Zm0,32.93H.48v5.04h10.99v11.14H.48v5.04h27.38v-5.04h-11.76v-11.14h11.76v-5.04Zm-22.71,24.5l-4.67.11v17.49h27.38v-5.04h-11.28v-10.44l-4.42-.04v10.48h-7.01v-12.56Z"></path>
                                    </g>
                                </svg>
                                <svg id="fhlogo_farbmarke" viewBox="0 0 66.77 601.71" xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <rect height="200.3" style="fill:#00b1aa;" width="66.77" x="0" y=".81"></rect>
                                        <rect height="200.3" style="fill:#ffffff;" width="66.77" x="0" y="201.11"></rect>
                                        <rect height="200.3" width="66.77" x="0" y="401.41"></rect>
                                    </g>
                                </svg>
                            </span></a>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <h3 id="demographicsTitle" class="display-6">Informed Consent Generator</h3>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col mb-1">
                            Obtaining informed consent ensures the users' autonomy and privacy, and that the users are aware of potential risks and benefits of your HCI study. That consent should be freely given, specific, informed and unambiguous by way of a request presented in clear and plain language. Consent should be given by an affirmative act, such as checking a box online or signing the form. Please reach out to your supervisor in case of any requests.
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col mb-1">
                            This informed consent is not suitable for vulnerable groups (children, disabled, prisoners) or when any harm can occur (medical studies). Please consult your local ethics committee. 
                        </div>
                    </div>
                    <hr />
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="institutionText">Your Institution</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="institution" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="researchText">Kind of research</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="type" onchange="onChange(event)" required></select></div>
                    </div>
                    
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="topicText">Title</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="title" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="compensationText">Compensation</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="compensation" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="monetaryCompensationText">Monetary Compensation </span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="monetaryCompensation" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="recordingsText">Recorded Data</span></div>
                        <div class="col-8">
                            <div class="row row-cols-3">
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordDemographics" id="recordDemographics" onchange="onChange(event)" checked required><label class="form-check-label" for="recordDemographics">Demographics<span class="text-danger">*</span></label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordContact" id="recordContact" onchange="onChange(event)"><label class="form-check-label" for="recordContact">Contact information</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordNotes" id="recordNotes" onchange="onChange(event)"><label class="form-check-label" for="recordNotes">Manual notes</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordInteraction" id="recordInteraction" onchange="onChange(event)"><label class="form-check-label" for="recordInteraction">User Interaction</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordAudio" id="recordAudio" onchange="onChange(event)"><label class="form-check-label" for="recordAudio">Audio</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordPhotos" id="recordPhotos" onchange="onChange(event)"><label class="form-check-label" for="recordPhotos">Photos</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordVideos" id="recordVideos" onchange="onChange(event)"><label class="form-check-label" for="recordVideos">Videos</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordMotion" id="recordMotion" onchange="onChange(event)"><label class="form-check-label" for="recordMotion">Motion Tracking</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordPhysiological" id="recordPhysiological" onchange="onChange(event)"><label class="form-check-label" for="recordPhysiological">Physio. Sensing</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordEyetracking" id="recordEyetracking" onchange="onChange(event)"><label class="form-check-label" for="recordEyetracking">Eye/Head Tracking</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordScreenrecording" id="recordScreenrecording" onchange="onChange(event)"><label class="form-check-label" for="recordScreenrecording">Screen Recording</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordNotes" id="recordNotes" onchange="onChange(event)"><label class="form-check-label" for="recordNotes">Manual notes</label></div>
                            </div>                      
                        </div>                      
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="personalDataText">Which personal data will be collected? (list all)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="personalData" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="storageTimeText">How long will the data stored with the researchers?</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="storageTime" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="shareText">Do you make the raw data public?</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="share" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="encryptionText">Will the data be stored encrypted?</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="encryption" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="durationText">Estimated Study Duration</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="duration" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="durationText">Estimated Number of Participants</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="participants" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="purposeText">Purpose (one sentence)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="purpose" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="goalText">Goal (one sentence)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="goal" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="procedureText">Procedure (in 4-6 steps)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><textarea rows="4" class="form-control" name="procedure" onchange="onChange(event)" required></textarea></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thePIname">First Researchers' Name (The PI)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="thePIname" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thePIemail">First Researchers' E-Mail</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" type="email" name="thePIemail" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="PIText">Head of the Department (if not = PI)</span></div>
                        <div class="col-8"><input class="form-control" name="departmentHead" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3" id="addResearchersContainer">
                        <div class="col-4"><span id="thePIname">All other researchers' involved</span><span class="text-danger">*</span></div>
                        <div class="col-8"><button class="btn btn-success" id="btnAddResearcher" type="button" id="button-add-researcher">+ Add Addional Researcher</button></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="funding">Funding</span></div>
                        <div class="col-8"><input class="form-control" name="funding" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="ethicalComitteeText">Ethical Comittee</span></div>
                        <div class="col-8"><input class="form-control" name="ethicalComittee" onchange="onChange(event)"></input></div>
                    </div>
                    </div>
                    <div class="row mt-3 mb-3 itemRow" id="fieldsrequired">
                        <div class="col" >
                            <span class="text-danger">* fields required</span> <br />
                        </div>
                    </div>
                    <hr class="uiEdit">
                    <div class="row mt-3 itemRow uiEdit">
                        <div class="col-8">
                            <a id="btnExample" class="btn btn-secondary btn-md float-left mr-3 " >Example</a> 
                            <a id="btnSave" class="btn btn-secondary btn-md float-left mr-3 btnSave" >Save Settings (*.json)</a>
                            <a id="btnLoad" class="btn btn-secondary btn-md float-left mr-3">Load Settings (*.json)</a>
                            <input class="form-control form-control-sm" id="fileInput" type="file" type="hidden" style='display: none;'>
                        </div>
                        <div class="d-grid gap-2 col-4 mx-auto">
                            <button id="btnGenerate" class="btn btn-primary btn-md float-right" type="Submit" value="">Generate From</button>
                        </div>
                    </div>

                    <div class="row mt-2 itemRow uiView">
                        <div class="col" >
                            <button id="btnBack" class="btn btn-primary btn-md float-left btnBack" >Back</button> 
                            <button id="btnSave" class="btn btn-secondary btn-md float-left mr-3 btnSave" >Save (*.json)</button>
                            <button id="btnPrint" class="btn btn-primary btn-md float-right" value="">Print</button>
                        </div>
                    </div>
                <div id="results"></div>
                <div class="row mt-2 mb-2 itemRow" id="githublink">
                    <div class="row mt-2 itemRow uiView">
                        <div class="col" >
                            <button id="btnBack" class="btn btn-primary btn-md float-left btnBack" >Back</button>
                        </div>
                    </div>
                    <div class="col" >
                        <small><a href="https://github.com/interactionlab/informed-consent-generator/">Original Source Code on GitHub</a></small><small> running <span id="version"></span></small>
                    </div>
                </div>
            </form>
        </div>        
    </div>

    <script src="./templating.js"></script>
    <script>

        function onChange(event){
            data = collectData();
        }

        function capitalize(s)
        {
            return s && s[0].toUpperCase() + s.slice(1);
        }

        function capital_letter(str) {
            str = str.replace(/\s\s+/g, ' ');
            str = str.split(" ");
            for (var i = 0, x = str.length; i < x; i++) {
                str[i] = str[i][0].toUpperCase() + str[i].substr(1);
            }
            return str.join(" ");
        }

        function downloadObjectAsJson(data, fileName){
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 4));
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", fileName);
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }

        var inputKeys = ["title", "duration", "personalData", "storageTime", "purpose", "goal", "departmentHead", "thePIname", "thePIemail", "participants", "monetaryCompensation", "ethicalComittee", "funding"];
        var inputRecord = ["demographics", "contact", "audio", "photos", "videos", "motion", "physiological", "eyetracking", "screenrecording", "notes", "interaction"];

        function myXOR(a,b) {
          return ( a || b ) && !( a && b );
        }

        function fillSelect(){
            document.getElementById("version").innerHTML = settings["version"];

            $("select[name='institution']").append(new Option(settings["hints"]["select"], ""));
            for (let key in settings["institutions"]) {
                let institution = settings["institutions"][key]
                $("select[name='institution']").append(new Option(institution["name"], institution["name"]));
            }

            $("select[name='type']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["types"].length; i++) {
                type = settings["types"][i]
                $("select[name='type']").append(new Option(type[0], type[1]));
            }
            
            $("select[name='share']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["dataShare"].length; i++) {
                share = settings["dataShare"][i]
                $("select[name='share']").append(new Option(share[0], share[1]));
            }

            $("select[name='encryption']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["dataEncryption"].length; i++) {
                encryption = settings["dataEncryption"][i]
                $("select[name='encryption']").append(new Option(encryption[0], encryption[1]));
            }

            $("select[name='compensation']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["compensation"].length; i++) {
                compensation = settings["compensation"][i]
                $("select[name='compensation']").append(new Option(compensation[0], compensation[1]));
            }
            
            var hints = settings["hints"]
            for (let key in hints) {
                if (key == "select"){
                    //None
                }
                else if (key == "procedure"){
                    $("textarea[name='" + key + "'] ").attr("placeholder", hints[key]);
                } else {
                    $("input[name='" + key + "'] ").attr("placeholder", hints[key]);
                }
            }


            $("#hostUrl").attr("href", settings["hostUrl"]);
            console.log(settings["hostLogo"]);
            $("#hostLogo").attr("src", "img/" + settings["hostLogo"]);

            let cookieData = getCookie("data");

            if (cookieData != null){
                cookieData = JSON.parse(cookieData);
                fillData(cookieData);
            } else {
                for (let i = 0; i < settings["researcherCount"]; i++){
                    addResearcher();
                }
            }
        }

        function addResearcher (){
            var lstResearchers = document.getElementsByClassName("researchersContainer");
                var lastElement = null;
                if (lstResearchers.length == 0){
                    lastElement = document.getElementById("addResearchersContainer");
                } else {
                    lastElement = lstResearchers[lstResearchers.length-1];
                }
                var link = `<div class="row mt-3 researchersContainer">
                        <div class="col-4"></div>
                        <div class="col-8">
                            <div class="row mt-3">
                                <div class="col-2"><span class="researcherName">Name</span><span class="text-danger">*</span></div>
                                <div class="col-10">
                                    <div class="input-group">
                                    <input class="form-control" name="researcherName" onchange="onChange(event)" required></input>
                                    <button class="btn btn-danger btnRemoveResearcher" onclick="removeResearcher(1)" type="button">-</button>
                                    </div>
                                </div>    
                            </div>
                            <div class="row mt-3">
                                <div class="col-2"><span class="researcherEmail">E-Mail</span><span class="text-danger">*</span></div>
                                <div class="col-10"><input class="form-control" name="researcherEmail" input type="email" onchange="onChange(event)" required></input>
                                </div>
                            </div>
                        </div>
                    </div>`;
                lastElement.insertAdjacentHTML("afterend", link);
                correctResercherNumbers();
        }

        function removeResearcher(value){
            var lstResearchers = document.getElementsByClassName("researchersContainer");
            if (lstResearchers.length > 0){
                lstResearchers[value].remove();
            }
            correctResercherNumbers();
            data = collectData();
        }

        function correctResercherNumbers (){
            var lstResearchers = document.getElementsByClassName("researcherName");
            for (var i = 0; i < lstResearchers.length; i++){
                var researcherName = lstResearchers[i];
                researcherName.innerHTML = "Name " + (i+1);
            }
            var lstResearchers = document.getElementsByClassName("btnRemoveResearcher");
            for (var i = 0; i < lstResearchers.length; i++){
                var researcherName = lstResearchers[i];
                researcherName.setAttribute("onclick", "removeResearcher(" + (i) + ")"); 
            }
            var lstResearchers = document.getElementsByClassName("researcherEmail");
            for (var i = 0; i < lstResearchers.length; i++){
                var researcherName = lstResearchers[i];
                researcherName.innerHTML = "E-mail " + (i+1);
            }
        }
        
        function fillData(data){
            $("textarea[name='procedure']").val(data["procedure"]);
            var record = data["record"];
            for (let key in record) {
                $("input[name='record" + capitalize(key) + "']").prop("checked", record[key]);
            }
            
            inputKeys.forEach((key) => {
                $("input[name='" + key + "']").val(data[key]);
            });

            $("select[name='institution'] option[value='" + data["institution"] + "']").attr("selected", true);
            $("select[name='type'] option[value='" + data["type"] + "']").attr("selected", true);
            $("select[name='share'] option[value='" + data["share"] + "']").attr("selected", true);
            $("select[name='encryption'] option[value='" + data["encryption"] + "']").attr("selected", true);
            $("select[name='compensation'] option[value='" + data["compensation"] + "']").attr("selected", true);

            document.querySelectorAll(".researchersContainer").forEach(el => el.remove());
            if (data["researchers"] != null){
                data["researchers"].forEach((researcher) => {
                    addResearcher();
                    var lstResearchers = document.getElementsByClassName("researchersContainer");
                    var lastElement = lstResearchers[lstResearchers.length-1];
                    lastElement.getElementsByClassName("form-control")[0].value = researcher["name"];
                    lastElement.getElementsByClassName("form-control")[1].value = researcher["email"];
                });
            }
        }



        const makeCommaSeparatedString = (arr, andSeparator, useOxfordComma) => {
            const listStart = arr.slice(0, -1).join(', ');
            const listEnd = arr.slice(-1);
            const conjunction = arr.length <= 1 ? '' : useOxfordComma && arr.length > 2 ? ', ' + andSeparator + ' ' : ' ' + andSeparator + ' ';
            return [listStart, listEnd].join(conjunction)
        }

        function generate(){
            var template = Handlebars.templates.template_en;
            data = collectData();
            let institution = settings["institutions"][data["institution"]]
            console.log({...data, ...institution});
            if (template != null) {
                let result = template({...data, ...institution});
                $("#results").html(result);
            }

            setTimeout(function () {
                     window.print();
                 }, 100);
        }

        var settings = {};
        var data = {};
        $(document).ready(function() {
            
            fetch('./settings.json')
                .then((response)=>response.json())
                .then((responseJson)=>{settings = responseJson; fillSelect();});

            $(".uiEdit").show();
            $(".uiView").hide();
            $(".btnBack").click(function(e){
                e.preventDefault();
                $(".uiEdit").show();
                $(".uiView").hide();
                $("#input").show(); 
                $("#fieldsrequired").show();
                $("#btnGenerate").show();
                $("#results").html("");
            });
            
            $("#btnPrint").click(function(e){
                $('.print_special').css({ border : 'none'});
                window.print(); 
                e.preventDefault();
            });

            $("#btnAddResearcher").click(function(e){addResearcher ();});
            
            $(".btnSave").click(function() {
                data = collectData();
                downloadObjectAsJson(data, "exportInformedConsent.json");
            });

            $("#btnTemplate").click(function() {

                var template = Handlebars.templates.template_en;
                data = collectData();
                let institution = settings["institutions"][data["institution"]]
                console.log({...data, ...institution});
                if (template != null) {
                    let result = template({...data, ...institution});
                    $("#results").html(result);
                }

            });

            $("#btnLoad").click(function() { 
                $("#fileInput").click();
            });

            $('#fileInput').change(function (e) { 
                var [file] = document.querySelector('#fileInput').files;
                var reader = new FileReader();

                reader.onload = function(event) {
                    var jsonObj = JSON.parse(event.target.result);
                    data = jsonObj;
                    fillData(data);
                };

                reader.readAsText(event.target.files[0]);
            });

            $("#btnExample").click(function() {
                fetch('./example.json')
                    .then((response)=>response.json())
                    .then((example)=>{fillData(example);data = collectData();});
            });

        });
         
    </script>
 </body>
</html>